<div class="oppia-learner-view-card" [@fadeInOut]="this.displayedCard">
  <!-- New UI for the question -->
  <div class="oppia-learner-view-card-top-section">
    <svg width="30" class="left-side-curve" height="24" viewBox="0 0 30 24" fill="none" xmlns="http://www.w3.org/2000/svg"
    [ngStyle]="isLanguageRTL() ? {'transform': 'scaleX(-1)'} : {}">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M0.832031 0C12.8267 5.31326 22.692 13.4676 29.1014 23.3701V0H0.832031Z" fill="white"/>
    </svg>
    <img class="conversation-skin-oppia-avatar" [src]="OPPIA_AVATAR_IMAGE_URL" alt=""
          *ngIf="avatarImageIsShown">
    <div class="oppia-rte-viewer oppia-learner-view-card-top-content"
          [ngClass]="getContentAudioHighlightClass()">
      <div tabindex="0">
        <oppia-rte-output-display [rteString]="displayedCard.getContentHtml()"
                                  class="e2e-test-conversation-content">
        </oppia-rte-output-display>
      </div>
      <div *ngIf="isContentAudioTranslationAvailable()" class="conversation-skin-audio-controls">
      </div>
    </div>
  </div>
  <!-- New UI for the question -->

  <div class="conversation-skin-tutor-card-middle-section"
       *ngIf="(arePreviousResponsesShown && !conceptCardIsBeingShown)" [@expandInOut]>
    <div *ngFor="let responsePair of displayedCard.getInputResponsePairs(); index as index">
      <div *ngIf="index !== (displayedCard.getInputResponsePairs().length - 1) || !isInteractionInline()">
        <oppia-new-input-response-pair [data]="responsePair"
                                  [profilePicturePngDataUrl]="profilePicturePngDataUrl"
                                  [profilePictureWebpDataUrl]="profilePictureWebpDataUrl"
                                  [oppiaAvatarImageUrl]="OPPIA_AVATAR_IMAGE_URL"
                                  [inputResponsePairId]="getInputResponsePairId($index)"
                                  [isLastPair]="false"
                                  [feedbackIsEnabled]="feedbackIsEnabled">
        </oppia-new-input-response-pair>
      </div>
    </div>
  </div>

  <!-- If the interaction is inline, always show the most recent response pair, if there is one. -->
  <div class="conversation-skin-tutor-card-bottom-section" *ngIf="isInteractionInline() && displayedCard.getInputResponsePairs().length > 0">
    <oppia-new-input-response-pair [data]="displayedCard.getInputResponsePairs()[displayedCard.getInputResponsePairs().length - 1]"
                              [bottomSection]="true"
                              [profilePicturePngDataUrl]="profilePicturePngDataUrl"
                              [profilePictureWebpDataUrl]="profilePictureWebpDataUrl"
                              [oppiaAvatarImageUrl]="OPPIA_AVATAR_IMAGE_URL"
                              [inputResponsePairId]="getInputResponsePairId(displayedCard.getInputResponsePairs().length - 1)"
                              [isLastPair]="true"
                              [feedbackIsEnabled]="feedbackIsEnabled">
    </oppia-new-input-response-pair>
  </div>

  <div *ngIf="displayedCardWasCompletedInPrevSession && !conceptCardIsBeingShown && (displayedCard.getInteractionId() != 'Continue')">
    <div class="conversation-skin-oppia-feedback-container conversation-skin-oppia-completed-state-card">
      <img class="conversation-skin-oppia-avatar rounded-circle" [src]="OPPIA_AVATAR_IMAGE_URL" alt="">
      <div class="conversation-skin-oppia-feedback-content">
        {{ 'I18N_EXPLORATION_STATE_PREVIOUSLY_COMPLETED' | translate }}
      </div>
    </div>
  </div>
</div>


<!--
Show the interaction (if it is inline) or the interaction instructions
(if the interaction is supplemental).

In addition, if the exploration is iframed, the terminal card will
have no learner input section, so we do not show it.
-->
<div *ngIf="!displayedCardWasCompletedInPrevSession && isInteractionInline() && !shouldHideInteraction && isCurrentCardAtEndOfTranscript() && !waitingForOppiaFeedback &&
((displayedCard.getInteractionHtml() && !displayedCard.isCompleted()) || displayedCard.isCompleted()) &&
(!isOnTerminalCard() || !isIframed || displayedCard.isCompleted())">
  <div class="conversation-skin-inline-interaction"
      [ngStyle]="(displayedCard.getInteractionId() != 'Continue') ?
                  {'background-color': '#fff', 'box-shadow': '0px 0px 10px 0px rgba(0, 100, 92, 0.5)'} : {}">
    <!-- The seemingly redundant check for isInteractionInline() is necessary
      because the parent ng-show does not remove the element from the DOM.
      This can lead to two conflicting copies of the interaction for
      non-inline interactions. -->
    <div *ngIf="isInteractionInline() && displayedCard.getInteractionHtml() && !displayedCard.isCompleted() && !conceptCardIsBeingShown">
      <oppia-interaction-display classStr="e2e-test-conversation-input"
                                  [htmlData]="displayedCard.getInteractionHtml()">
      </oppia-interaction-display>
    </div>
  </div>
</div>

<div *ngIf="!isInteractionInline() && !conceptCardIsBeingShown" class="conversation-skin-inline-interaction">
  <div class="oppia-conversation-skin-instruction-container">
    <span [ngClass]="{'conversation-skin-instruction-disabled': !interactionIsActive}">
      {{ interactionInstructions | translate }}
    </span>
    <i *ngIf="canWindowShowTwoCards() && !isLanguageRTL()" [ngClass]="{'conversation-skin-instruction-disabled': !interactionIsActive}" class="fas fa-arrow-right position-relative"></i>
    <i *ngIf="canWindowShowTwoCards() && isLanguageRTL()" [ngClass]="{'conversation-skin-instruction-disabled': !interactionIsActive}" class="fas fa-arrow-left position-relative"></i>
    <i *ngIf="!canWindowShowTwoCards()" [ngClass]="{'conversation-skin-instruction-disabled': !interactionIsActive}" class="fas fa-arrow-down position-relative"></i>
  </div>

  <div *ngIf="!displayedCard.getInteractionId() && !isOnTerminalCard() && !conceptCardIsBeingShown">
    <div class="conversation-skin-inline-interaction">
      <span class="oppia-no-interaction-text">
        <strong>Error</strong>: No interaction specified for '{{ displayedCard.getStateName() }}'.
      </span>
    </div>
  </div>
</div>
